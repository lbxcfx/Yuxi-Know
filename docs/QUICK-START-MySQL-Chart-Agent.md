# React Agent MySQL æ•°æ®æŸ¥è¯¢ä¸å›¾è¡¨ç”Ÿæˆ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: ç¡®è®¤ç³»ç»ŸçŠ¶æ€

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
docker ps | grep -E "api-dev|mysql-dev"

# æ£€æŸ¥ MySQL å·¥å…·æ˜¯å¦åŠ è½½
docker exec api-dev python -c "
from src.agents.common.tools import get_buildin_tools
tools = get_buildin_tools()
mysql_tools = [t.name for t in tools if 'mysql' in t.name]
print(f'MySQL Tools: {mysql_tools}')
"
```

**é¢„æœŸè¾“å‡º**ï¼š
```
MySQL Tools: ['mysql_list_tables', 'mysql_describe_table', 'mysql_query']
```

### æ­¥éª¤ 2: é…ç½® React Agent

å·²ä¸ºæ‚¨åˆ›å»ºå¥½é…ç½®æ–‡ä»¶ï¼š`saves/config/agents/ReActAgent/context.json`

**é…ç½®å†…å®¹**ï¼š
- âœ… å¯ç”¨ `mcp-server-chart` MCP æœåŠ¡ï¼ˆ25 ç§å›¾è¡¨ç±»å‹ï¼‰
- âœ… ä¼˜åŒ–çš„ç³»ç»Ÿ promptï¼ˆæŒ‡å¯¼ 5 æ­¥å·¥ä½œæµç¨‹ï¼‰
- âœ… ä½¿ç”¨ `dashscope/qwen-max` æ¨¡å‹

**æˆ–è€…é€šè¿‡å‰ç«¯é…ç½®**ï¼š
1. æ‰“å¼€ React Agent é…ç½®é¡µé¢
2. åœ¨ "MCP æœåŠ¡å™¨" ä¸­å‹¾é€‰ `mcp-server-chart`
3. ä¿å­˜é…ç½®

### æ­¥éª¤ 3: å‡†å¤‡æµ‹è¯•æ•°æ®

æ‚¨å·²ç»æœ‰äº†æµ‹è¯•æ•°æ®è¡¨ï¼š`æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ`

éªŒè¯æ•°æ®ï¼š
```bash
docker exec mysql-dev mysql -utestuser -ptestpassword testdb -e "
SELECT COUNT(*) as total_rows FROM \`æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ\`;
"
```

### æ­¥éª¤ 4: å¼€å§‹ä½¿ç”¨

åœ¨å‰ç«¯èŠå¤©ç•Œé¢ä¸­ï¼Œç›´æ¥æé—®ï¼š

```
ä» MySQL æ•°æ®åº“ä¸­æŸ¥è¯¢ç–¾ç—…ç±»å‹åˆ†å¸ƒï¼Œå¹¶ç”¨é¥¼çŠ¶å›¾å±•ç¤º
```

Agent ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š
1. ğŸ” æŸ¥çœ‹æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨
2. ğŸ” æŸ¥çœ‹ `æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ` è¡¨ç»“æ„
3. ğŸ“Š æ‰§è¡Œ SQL: `SELECT ç–¾ç—…ç±»å‹, COUNT(*) FROM ... GROUP BY ç–¾ç—…ç±»å‹`
4. ğŸ“ˆ è°ƒç”¨ `generate_pie_chart` ç”Ÿæˆé¥¼çŠ¶å›¾
5. âœ… è¿”å›å›¾è¡¨ URL

## ğŸ“Š æ›´å¤šä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: å¹´é¾„åˆ†å¸ƒæŸ±çŠ¶å›¾

```
æŸ¥è¯¢æ‚£è€…å¹´é¾„åˆ†å¸ƒï¼Œç”¨æŸ±çŠ¶å›¾å±•ç¤º
```

**Agent æ‰§è¡Œ**ï¼š
- SQL: `SELECT å¹´é¾„, COUNT(*) FROM ... GROUP BY å¹´é¾„ ORDER BY å¹´é¾„`
- å›¾è¡¨: `generate_column_chart`

### ç¤ºä¾‹ 2: æœˆåº¦å°±è¯Šè¶‹åŠ¿

```
æŸ¥è¯¢æœ€è¿‘çš„å°±è¯Šæ—¥æœŸè¶‹åŠ¿ï¼Œç”¨æŠ˜çº¿å›¾å±•ç¤º
```

**Agent æ‰§è¡Œ**ï¼š
- SQL: `SELECT å°±è¯Šæ—¥æœŸ, COUNT(*) FROM ... GROUP BY å°±è¯Šæ—¥æœŸ ORDER BY å°±è¯Šæ—¥æœŸ`
- å›¾è¡¨: `generate_line_chart`

### ç¤ºä¾‹ 3: åŒ»ä¿è‡ªè´¹å¯¹æ¯”

```
å¯¹æ¯”åŒ»ä¿è´¹ç”¨å’Œè‡ªè´¹çš„å¹³å‡å€¼
```

**Agent æ‰§è¡Œ**ï¼š
- SQL: `SELECT AVG(åŒ»ä¿è´¹ç”¨) as avg_insurance, AVG(è‡ªè´¹) as avg_self FROM ...`
- å¯èƒ½ä½¿ç”¨æŸ±çŠ¶å›¾æˆ–åŒè½´å›¾å±•ç¤º

### ç¤ºä¾‹ 4: æ€§åˆ«åˆ†å¸ƒé¥¼å›¾

```
æŸ¥çœ‹æ‚£è€…æ€§åˆ«åˆ†å¸ƒå æ¯”
```

**Agent æ‰§è¡Œ**ï¼š
- SQL: `SELECT æ€§åˆ«, COUNT(*) FROM ... GROUP BY æ€§åˆ«`
- å›¾è¡¨: `generate_pie_chart`

### ç¤ºä¾‹ 5: é—¨è¯Šç±»å‹ç»Ÿè®¡

```
ç»Ÿè®¡ä¸åŒé—¨è¯Šç±»å‹çš„æ‚£è€…æ•°é‡
```

**Agent æ‰§è¡Œ**ï¼š
- SQL: `SELECT é—¨è¯Šç±»å‹, COUNT(*) FROM ... GROUP BY é—¨è¯Šç±»å‹`
- å›¾è¡¨: `generate_column_chart`

## ğŸ¯ æ”¯æŒçš„å›¾è¡¨ç±»å‹

| æ•°æ®ç‰¹å¾ | æ¨èå›¾è¡¨ | ç¤ºä¾‹é—®é¢˜ |
|---------|---------|---------|
| åˆ†ç±»å æ¯” | é¥¼å›¾ | "ç–¾ç—…ç±»å‹åˆ†å¸ƒ" |
| åˆ†ç±»å¯¹æ¯” | æŸ±çŠ¶å›¾ | "å„ç§‘å®¤å°±è¯Šäººæ•°å¯¹æ¯”" |
| æ—¶é—´è¶‹åŠ¿ | æŠ˜çº¿å›¾ | "æœ€è¿‘ 3 ä¸ªæœˆå°±è¯Šè¶‹åŠ¿" |
| æ•°æ®åˆ†å¸ƒ | ç›´æ–¹å›¾ | "å¹´é¾„åˆ†å¸ƒæƒ…å†µ" |
| ä¸¤å˜é‡å…³ç³» | æ•£ç‚¹å›¾ | "å¹´é¾„ä¸è´¹ç”¨çš„å…³ç³»" |
| å¤šç»´å¯¹æ¯” | é›·è¾¾å›¾ | "ä¸åŒç–¾ç—…åœ¨å¤šä¸ªæŒ‡æ ‡ä¸Šçš„å¯¹æ¯”" |
| å±‚çº§æ•°æ® | æ ‘å›¾ | "åŒ»ç–—è´¹ç”¨çš„å±‚çº§åˆ†è§£" |
| æµç¨‹æ•°æ® | æ¡‘åŸºå›¾ | "æ‚£è€…å°±è¯Šæµç¨‹" |

å®Œæ•´åˆ—è¡¨ï¼š25 ç§å›¾è¡¨ç±»å‹ï¼Œä½¿ç”¨ `generate_*_chart` å·¥å…·

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: Agent æ²¡æœ‰è°ƒç”¨å·¥å…·

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ MCP é…ç½®ï¼šç¡®ä¿ `mcp-server-chart` å·²å¯ç”¨
2. æ£€æŸ¥ç³»ç»Ÿ promptï¼šç¡®ä¿å·²é…ç½®å·¥ä½œæµç¨‹æŒ‡å¯¼
3. ä½¿ç”¨æ›´æ˜ç¡®çš„é—®é¢˜ï¼š"ç”¨é¥¼çŠ¶å›¾å±•ç¤º" æ¯” "å±•ç¤ºåˆ†å¸ƒ" æ›´æ˜ç¡®

### Q2: SQL æŸ¥è¯¢å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- è¡¨åæˆ–å­—æ®µåæ‹¼å†™é”™è¯¯
- WHERE æ¡ä»¶è¿‡äºå¤æ‚

**è§£å†³æ–¹æ³•**ï¼š
- å…ˆé—®ï¼š"æ•°æ®åº“é‡Œæœ‰å“ªäº›è¡¨ï¼Ÿ"
- å†é—®ï¼š"[è¡¨å] çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"
- æœ€åå†è¿›è¡Œå…·ä½“æŸ¥è¯¢

### Q3: å›¾è¡¨ç”Ÿæˆå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- MCP æœåŠ¡å™¨è¿æ¥é—®é¢˜
- æ•°æ®æ ¼å¼ä¸åŒ¹é…

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ MCP æœåŠ¡çŠ¶æ€
docker logs api-dev | grep mcp-server-chart

# æ‰‹åŠ¨æµ‹è¯• chart å·¥å…·
docker exec api-dev python -c "
import asyncio
from src.agents.common.mcp import get_mcp_tools
tools = asyncio.run(get_mcp_tools('mcp-server-chart'))
print(f'Loaded {len(tools)} chart tools')
"
```

### Q4: ä¸­æ–‡è¡¨å/å­—æ®µåæŠ¥é”™

**å·²ä¿®å¤ï¼** âœ…

å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜ï¼Œæ£€æŸ¥ï¼š
```bash
# éªŒè¯ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ
docker exec api-dev python -c "
from src.agents.common.toolkits.mysql.security import MySQLSecurityChecker
print(MySQLSecurityChecker.validate_table_name('æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ'))
"
# åº”è¯¥è¾“å‡º: True
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´å·¥ä½œæµç¨‹**: `docs/react-agent-mysql-chart-workflow.md`
- **ç³»ç»Ÿ Prompt è¯¦è§£**: `docs/mysql-chart-system-prompt.md`
- **ä¸­æ–‡è¡¨åæ”¯æŒ**: `docs/chinese-table-name-fix.md`

## ğŸ¨ æç¤ºè¯æŠ€å·§

### âœ… å¥½çš„æé—®æ–¹å¼

```
1. "æŸ¥è¯¢ç–¾ç—…ç±»å‹åˆ†å¸ƒï¼Œç”¨é¥¼çŠ¶å›¾å±•ç¤º"
   â†’ æ˜ç¡®æŒ‡å®šäº†æ•°æ®å’Œå›¾è¡¨ç±»å‹

2. "ç»Ÿè®¡å„ç§‘å®¤çš„å°±è¯Šäººæ•°ï¼Œç”¨æŸ±çŠ¶å›¾å¯¹æ¯”"
   â†’ æ˜ç¡®äº†ç»Ÿè®¡ç»´åº¦å’Œå±•ç¤ºæ–¹å¼

3. "åˆ†ææœ€è¿‘çš„å°±è¯Šè¶‹åŠ¿ï¼Œç”¨æŠ˜çº¿å›¾"
   â†’ æ˜ç¡®äº†åˆ†æç›®æ ‡å’Œå›¾è¡¨

4. "æŸ¥çœ‹æ‚£è€…å¹´é¾„åˆ†å¸ƒ"
   â†’ è™½ç„¶æ²¡æŒ‡å®šå›¾è¡¨ï¼ŒAgent ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„
```

### âŒ ä¸å¤ªå¥½çš„æé—®æ–¹å¼

```
1. "ç»™æˆ‘çœ‹çœ‹æ•°æ®"
   â†’ å¤ªæ¨¡ç³Šï¼Œä¸çŸ¥é“çœ‹ä»€ä¹ˆæ•°æ®

2. "åšä¸ªå›¾"
   â†’ ä¸çŸ¥é“åšä»€ä¹ˆå›¾ï¼ŒåŸºäºä»€ä¹ˆæ•°æ®

3. "åˆ†æä¸€ä¸‹"
   â†’ åˆ†æä»€ä¹ˆï¼Ÿç”¨ä»€ä¹ˆæ–¹å¼ï¼Ÿ
```

### ğŸ’¡ æ¸è¿›å¼æé—®ç­–ç•¥

å¦‚æœä¸ç¡®å®šæ•°æ®ç»“æ„ï¼Œå¯ä»¥è¿™æ ·ï¼š

```
ç¬¬ 1 é—®: "æ•°æ®åº“é‡Œæœ‰å“ªäº›è¡¨ï¼Ÿ"
       â†’ Agent åˆ—å‡ºæ‰€æœ‰è¡¨

ç¬¬ 2 é—®: "æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ è¿™ä¸ªè¡¨çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"
       â†’ Agent å±•ç¤ºè¡¨ç»“æ„

ç¬¬ 3 é—®: "æŸ¥è¯¢ç–¾ç—…ç±»å‹çš„åˆ†å¸ƒï¼Œç”¨é¥¼çŠ¶å›¾å±•ç¤º"
       â†’ Agent æ‰§è¡Œå®Œæ•´æµç¨‹
```

## ğŸš€ é«˜çº§ç”¨æ³•

### å¤æ‚ SQL æŸ¥è¯¢

```
"æŸ¥è¯¢å¹´é¾„å¤§äº 50 å²çš„æ‚£è€…ä¸­ï¼Œç–¾ç—…ç±»å‹çš„åˆ†å¸ƒ"
```

Agent ä¼šç”Ÿæˆï¼š
```sql
SELECT `ç–¾ç—…ç±»å‹`, COUNT(*) as count
FROM `æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ`
WHERE `å¹´é¾„` > 50
GROUP BY `ç–¾ç—…ç±»å‹`
ORDER BY count DESC
```

### å¤šç»´åº¦åˆ†æ

```
"å¯¹æ¯”ä¸åŒæ€§åˆ«çš„æ‚£è€…åœ¨å„ç–¾ç—…ç±»å‹ä¸Šçš„åˆ†å¸ƒ"
```

Agent å¯èƒ½ï¼š
1. å…ˆæŒ‰æ€§åˆ«åˆ†ç»„æŸ¥è¯¢
2. å†æŒ‰ç–¾ç—…ç±»å‹åˆ†ç»„
3. ä½¿ç”¨åˆ†ç»„æŸ±çŠ¶å›¾æˆ–å †å æŸ±çŠ¶å›¾

### ç»Ÿè®¡èšåˆ

```
"è®¡ç®—æ¯ç§ç–¾ç—…ç±»å‹çš„å¹³å‡åŒ»ä¿è´¹ç”¨å’Œå¹³å‡è‡ªè´¹ï¼Œç”¨æŸ±çŠ¶å›¾å¯¹æ¯”"
```

Agent ä¼šç”Ÿæˆï¼š
```sql
SELECT `ç–¾ç—…ç±»å‹`,
       AVG(`åŒ»ä¿è´¹ç”¨`) as avg_insurance,
       AVG(`è‡ªè´¹`) as avg_self
FROM `æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ`
GROUP BY `ç–¾ç—…ç±»å‹`
```

ç„¶åç”¨åŒè½´å›¾æˆ–åˆ†ç»„æŸ±çŠ¶å›¾å±•ç¤ºã€‚

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ Agent æ‰§è¡Œæ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f api-dev

# è¿‡æ»¤ MySQL ç›¸å…³æ—¥å¿—
docker logs api-dev | grep -i mysql

# è¿‡æ»¤ MCP ç›¸å…³æ—¥å¿—
docker logs api-dev | grep -i mcp
```

### æµ‹è¯•å•ä¸ªå·¥å…·

```bash
# æµ‹è¯• mysql_list_tables
docker exec api-dev python -c "
from src.agents.common.toolkits.mysql.tools import mysql_list_tables
print(mysql_list_tables.invoke({}))
"

# æµ‹è¯• mysql_describe_table
docker exec api-dev python -c "
from src.agents.common.toolkits.mysql.tools import mysql_describe_table
print(mysql_describe_table.invoke({'table_name': 'æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ'}))
"

# æµ‹è¯• mysql_query
docker exec api-dev python -c "
from src.agents.common.toolkits.mysql.tools import mysql_query
print(mysql_query.invoke({
    'sql': 'SELECT \`ç–¾ç—…ç±»å‹\`, COUNT(*) as count FROM \`æ‚£è€…åŒ»ç–—æ•°æ®_50æ¡_å«å°±è¯Šæ—¥æœŸ\` GROUP BY \`ç–¾ç—…ç±»å‹\`',
    'limit': 10
}))
"
```

### æ£€æŸ¥é…ç½®

```bash
# æŸ¥çœ‹ Agent é…ç½®
cat saves/config/agents/ReActAgent/context.json

# æŸ¥çœ‹ MCP æœåŠ¡å™¨é…ç½®
docker exec api-dev python -c "
from src.agents.common.mcp import MCP_SERVERS
import json
print(json.dumps(MCP_SERVERS, indent=2, ensure_ascii=False))
"
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ•°æ®å‡†å¤‡
- âœ… ç¡®ä¿è¡¨ä¸­æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼ˆè‡³å°‘ 10 è¡Œï¼‰
- âœ… å­—æ®µå‘½åæ¸…æ™°ï¼ˆæœ€å¥½æœ‰è¯­ä¹‰ï¼‰
- âœ… æ•°æ®è´¨é‡è‰¯å¥½ï¼ˆå‡å°‘ NULL å€¼ï¼‰

### 2. æé—®æŠ€å·§
- âœ… æ˜ç¡®æŒ‡å®šè¦åˆ†æçš„ç»´åº¦
- âœ… æ˜ç¡®æœŸæœ›çš„å›¾è¡¨ç±»å‹
- âœ… å¦‚æœéœ€è¦è¿‡æ»¤ï¼Œæ˜ç¡®è¿‡æ»¤æ¡ä»¶

### 3. æ€§èƒ½ä¼˜åŒ–
- âœ… ä½¿ç”¨ LIMIT é™åˆ¶è¿”å›è¡Œæ•°
- âœ… é¿å…æŸ¥è¯¢å…¨è¡¨ï¼ˆæ·»åŠ  WHERE æ¡ä»¶ï¼‰
- âœ… å¯¹äºå¤§è¡¨ï¼Œå…ˆé‡‡æ ·å†åˆ†æ

### 4. å®‰å…¨æ€§
- âœ… ç³»ç»Ÿå·²å†…ç½® SQL æ³¨å…¥é˜²æŠ¤
- âœ… åªå…è®¸ SELECT æŸ¥è¯¢
- âœ… è‡ªåŠ¨è¶…æ—¶æ§åˆ¶ï¼ˆæœ€å¤š 60 ç§’ï¼‰

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨æ‚¨å·²ç»å‡†å¤‡å¥½äº†ï¼æ‰“å¼€å‰ç«¯èŠå¤©ç•Œé¢ï¼Œå¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼š

```
ä» MySQL æ•°æ®åº“ä¸­æŸ¥è¯¢ç–¾ç—…ç±»å‹åˆ†å¸ƒï¼Œå¹¶ç”¨é¥¼çŠ¶å›¾å±•ç¤º
```

äº«å—æ™ºèƒ½æ•°æ®åˆ†æçš„ä¹è¶£ï¼ğŸš€
